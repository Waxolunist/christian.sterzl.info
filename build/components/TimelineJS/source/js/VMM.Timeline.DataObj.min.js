"undefined"!=typeof VMM.Timeline&&"undefined"==typeof VMM.Timeline.DataObj&&(VMM.Timeline.DataObj={data_obj:{},model_array:[],getData:function(e){if(VMM.Timeline.DataObj.data_obj={},VMM.fireEvent(global,VMM.Timeline.Config.events.messege,VMM.Timeline.Config.language.messages.loading_timeline),"object"==type.of(e))trace("DATA SOURCE: JSON OBJECT"),VMM.Timeline.DataObj.parseJSON(e);else if("string"==type.of(e))if(e.match("%23"))trace("DATA SOURCE: TWITTER SEARCH"),VMM.Timeline.DataObj.model.tweets.getData("%23medill");else if(e.match("spreadsheet"))trace("DATA SOURCE: GOOGLE SPREADSHEET"),VMM.Timeline.DataObj.model.googlespreadsheet.getData(e);else if(e.match("storify.com"))trace("DATA SOURCE: STORIFY"),VMM.Timeline.DataObj.model.storify.getData(e);else if(e.match(".jsonp"))trace("DATA SOURCE: JSONP"),LoadLib.js(e,VMM.Timeline.DataObj.onJSONPLoaded);else{trace("DATA SOURCE: JSON");var t="";t=e.indexOf("?")>-1?e+"&callback=onJSONP_Data":e+"?callback=onJSONP_Data",VMM.getJSON(t,VMM.Timeline.DataObj.parseJSON)}else"html"==type.of(e)?(trace("DATA SOURCE: HTML"),VMM.Timeline.DataObj.parseHTML(e)):trace("DATA SOURCE: UNKNOWN")},onJSONPLoaded:function(){trace("JSONP IS LOADED"),VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,storyjs_jsonp_data)},parseHTML:function(){trace("parseHTML"),trace("WARNING: THIS IS STILL ALPHA AND WILL NOT WORK WITH ID's other than #timeline");var e=VMM.Timeline.DataObj.data_template_obj;if(VMM.Lib.find("#timeline section","time")[0]){e.timeline.startDate=VMM.Lib.html(VMM.Lib.find("#timeline section","time")[0]),e.timeline.headline=VMM.Lib.html(VMM.Lib.find("#timeline section","h2")),e.timeline.text=VMM.Lib.html(VMM.Lib.find("#timeline section","article"));var t=!1;0!=VMM.Lib.find("#timeline section","figure img").length?(t=!0,e.timeline.asset.media=VMM.Lib.attr(VMM.Lib.find("#timeline section","figure img"),"src")):0!=VMM.Lib.find("#timeline section","figure a").length&&(t=!0,e.timeline.asset.media=VMM.Lib.attr(VMM.Lib.find("#timeline section","figure a"),"href")),t&&(0!=VMM.Lib.find("#timeline section","cite").length&&(e.timeline.asset.credit=VMM.Lib.html(VMM.Lib.find("#timeline section","cite"))),0!=VMM.Lib.find(this,"figcaption").length&&(e.timeline.asset.caption=VMM.Lib.html(VMM.Lib.find("#timeline section","figcaption"))))}VMM.Lib.each("#timeline li",function(){var t=!1,a={type:"default",startDate:"",headline:"",text:"",asset:{media:"",credit:"",caption:""},tags:"Optional"};if(0!=VMM.Lib.find(this,"time")){t=!0,a.startDate=VMM.Lib.html(VMM.Lib.find(this,"time")[0]),VMM.Lib.find(this,"time")[1]&&(a.endDate=VMM.Lib.html(VMM.Lib.find(this,"time")[1])),a.headline=VMM.Lib.html(VMM.Lib.find(this,"h3")),a.text=VMM.Lib.html(VMM.Lib.find(this,"article"));var i=!1;0!=VMM.Lib.find(this,"figure img").length?(i=!0,a.asset.media=VMM.Lib.attr(VMM.Lib.find(this,"figure img"),"src")):0!=VMM.Lib.find(this,"figure a").length&&(i=!0,a.asset.media=VMM.Lib.attr(VMM.Lib.find(this,"figure a"),"href")),i&&(0!=VMM.Lib.find(this,"cite").length&&(a.asset.credit=VMM.Lib.html(VMM.Lib.find(this,"cite"))),0!=VMM.Lib.find(this,"figcaption").length&&(a.asset.caption=VMM.Lib.html(VMM.Lib.find(this,"figcaption")))),trace(a),e.timeline.date.push(a)}}),VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,e)},parseJSON:function(e){trace("parseJSON"),"default"==e.timeline.type?(trace("DATA SOURCE: JSON STANDARD TIMELINE"),VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,e)):"twitter"==e.timeline.type?(trace("DATA SOURCE: JSON TWEETS"),VMM.Timeline.DataObj.model_Tweets.buildData(e)):(trace("DATA SOURCE: UNKNOWN JSON"),trace(type.of(e.timeline)))},model:{googlespreadsheet:{extractSpreadsheetKey:function(e){var t=VMM.Util.getUrlVars(e).key;if(!t&&e.match("docs.google.com/spreadsheets/d/")){var a=e.indexOf("docs.google.com/spreadsheets/d/")+"docs.google.com/spreadsheets/d/".length,i=e.substr(a);t=i.split("/")[0]}return t||(t=e),t},getData:function(e){function t(){a=VMM.getJSON(s,function(e){clearTimeout(o),VMM.Timeline.DataObj.model.googlespreadsheet.buildData(e)}).error(function(e,t){return 400==e.status?(VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Error reading Google spreadsheet. Check the URL and make sure it's published to the web."),void clearTimeout(o)):(trace("Google Docs ERROR"),void trace("Google Docs ERROR: "+t+" "+e.responseText))}).success(function(){clearTimeout(o)})}var a,i,n,s,o,l=0;i=VMM.Timeline.DataObj.model.googlespreadsheet.extractSpreadsheetKey(e),n=VMM.Util.getUrlVars(e).worksheet,"undefined"==typeof n&&(n="od6"),s="https://spreadsheets.google.com/feeds/list/"+i+"/"+n+"/public/values?alt=json",o=setTimeout(function(){trace("Google Docs timeout "+s),trace(s),3>l?(VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Still waiting on Google Docs, trying again "+l),l++,a.abort(),t()):VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Google Docs is not responding")},16e3),t()},buildData:function(e){function t(e){return"undefined"!=typeof e?e.$t:""}var a=VMM.Timeline.DataObj.data_template_obj,i=!1;if(VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Parsing Google Doc Data"),"undefined"==typeof e.feed.entry)VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Error parsing spreadsheet. Make sure you have no blank rows and that the headers have not been changed.");else{i=!0;for(var n=0;n<e.feed.entry.length;n++){var s=e.feed.entry[n],o="";if("undefined"!=typeof s.gsx$type?o=s.gsx$type.$t:"undefined"!=typeof s.gsx$titleslide&&(o=s.gsx$titleslide.$t),o.match("start")||o.match("title"))a.timeline.startDate=t(s.gsx$startdate),a.timeline.headline=t(s.gsx$headline),a.timeline.asset.media=t(s.gsx$media),a.timeline.asset.caption=t(s.gsx$mediacaption),a.timeline.asset.credit=t(s.gsx$mediacredit),a.timeline.text=t(s.gsx$text),a.timeline.type="google spreadsheet";else if(o.match("era")){var l={startDate:t(s.gsx$startdate),endDate:t(s.gsx$enddate),headline:t(s.gsx$headline),text:t(s.gsx$text),tag:t(s.gsx$tag)};a.timeline.era.push(l)}else{var r={type:"google spreadsheet",startDate:t(s.gsx$startdate),endDate:t(s.gsx$enddate),headline:t(s.gsx$headline),text:t(s.gsx$text),tag:t(s.gsx$tag),asset:{media:t(s.gsx$media),credit:t(s.gsx$mediacredit),caption:t(s.gsx$mediacaption),thumbnail:t(s.gsx$mediathumbnail)}};a.timeline.date.push(r)}}}i?(VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Finished Parsing Data"),VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,a)):(VMM.fireEvent(global,VMM.Timeline.Config.events.messege,VMM.Language.messages.loading+" Google Doc Data (cells)"),trace("There may be too many entries. Still trying to load data. Now trying to load cells to avoid Googles limitation on cells"),VMM.Timeline.DataObj.model.googlespreadsheet.getDataCells(e.feed.link[0].href))},getDataCells:function(e){function t(){a=VMM.getJSON(n,function(e){clearTimeout(s),VMM.Timeline.DataObj.model.googlespreadsheet.buildDataCells(e)}).error(function(e,t){trace("Google Docs ERROR"),trace("Google Docs ERROR: "+t+" "+e.responseText)}).success(function(){clearTimeout(s)})}var a,i,n,s,o=0;i=VMM.Timeline.DataObj.model.googlespreadsheet.extractSpreadsheetKey(e),n="https://spreadsheets.google.com/feeds/cells/"+i+"/od6/public/values?alt=json",s=setTimeout(function(){trace("Google Docs timeout "+n),trace(n),3>o?(VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Still waiting on Google Docs, trying again "+o),o++,a.abort(),t()):VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Google Docs is not responding")},16e3),t()},buildDataCells:function(e){function t(e){return"undefined"!=typeof e?e.$t:""}var a=VMM.Timeline.DataObj.data_template_obj,i=!1,n=["timeline"],s=[],o=0,l=0;if(VMM.fireEvent(global,VMM.Timeline.Config.events.messege,VMM.Language.messages.loading_timeline+" Parsing Google Doc Data (cells)"),"undefined"!=typeof e.feed.entry){for(i=!0,l=0;l<e.feed.entry.length;l++){var r=e.feed.entry[l];parseInt(r.gs$cell.row)>o&&(o=parseInt(r.gs$cell.row))}for(var l=0;o+1>l;l++){var d={type:"",startDate:"",endDate:"",headline:"",text:"",tag:"",asset:{media:"",credit:"",caption:"",thumbnail:""}};s.push(d)}for(l=0;l<e.feed.entry.length;l++){var r=e.feed.entry[l],m="",c={content:t(r.gs$cell),col:r.gs$cell.col,row:r.gs$cell.row,name:""};1==c.row?("Start Date"==c.content?m="startDate":"End Date"==c.content?m="endDate":"Headline"==c.content?m="headline":"Text"==c.content?m="text":"Media"==c.content?m="media":"Media Credit"==c.content?m="credit":"Media Caption"==c.content?m="caption":"Media Thumbnail"==c.content?m="thumbnail":"Type"==c.content?m="type":"Tag"==c.content&&(m="tag"),n.push(m)):(c.name=n[c.col],s[c.row][c.name]=c.content)}for(l=0;l<s.length;l++){var d=s[l];if(d.type.match("start")||d.type.match("title"))a.timeline.startDate=d.startDate,a.timeline.headline=d.headline,a.timeline.asset.media=d.media,a.timeline.asset.caption=d.caption,a.timeline.asset.credit=d.credit,a.timeline.text=d.text,a.timeline.type="google spreadsheet";else if(d.type.match("era")){var g={startDate:d.startDate,endDate:d.endDate,headline:d.headline,text:d.text,tag:d.tag};a.timeline.era.push(g)}else if(d.startDate){var d={type:"google spreadsheet",startDate:d.startDate,endDate:d.endDate,headline:d.headline,text:d.text,tag:d.tag,asset:{media:d.media,credit:d.credit,caption:d.caption,thumbnail:d.thumbnail}};a.timeline.date.push(d)}else trace("Skipping item "+l+" in list: no start date.")}}i=a.timeline.date.length>0,i?(VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Finished Parsing Data"),VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,a)):VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Unable to load Google Doc data source. Make sure you have no blank rows and that the headers have not been changed.")}},storify:{getData:function(e){var t,a,i;VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Loading Storify..."),t=e.split("storify.com/")[1],a="//api.storify.com/v1/stories/"+t+"?per_page=300&callback=?",i=setTimeout(function(){trace("STORIFY timeout"),VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Storify is not responding")},6e3),VMM.getJSON(a,VMM.Timeline.DataObj.model.storify.buildData).error(function(e,t){trace("STORIFY error"),trace("STORIFY ERROR: "+t+" "+e.responseText)}).success(function(){clearTimeout(i)})},buildData:function(e){VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Parsing Data");var t=VMM.Timeline.DataObj.data_template_obj;t.timeline.startDate=new Date(e.content.date.created),t.timeline.headline=e.content.title,trace(e);var a="",i=e.content.author.username,n="";"undefined"!=typeof e.content.author.name&&(i=e.content.author.name,n=e.content.author.username+"&nbsp;"),"undefined"!=typeof e.content.description&&null!=e.content.description&&(a+=e.content.description),a+="<div class='storify'>",a+="<div class='vcard author'><a class='screen-name url' href='"+e.content.author.permalink+"' target='_blank'>",a+="<span class='avatar'><img src='"+e.content.author.avatar+"' style='max-width: 32px; max-height: 32px;'></span>",a+="<span class='fn'>"+i+"</span>",a+="<span class='nickname'>"+n+"<span class='thumbnail-inline'></span></span>",a+="</a>",a+="</div>",a+="</div>",t.timeline.text=a,t.timeline.asset.media=e.content.thumbnail,t.timeline.type="storify";for(var s=0;s<e.content.elements.length;s++){{var o=e.content.elements[s],l=!1;new Date(o.posted_at)}trace(o.type);var r={type:"storify",startDate:o.posted_at,endDate:o.posted_at,headline:" ",slug:"",text:"",asset:{media:"",credit:"",caption:""}};if("image"==o.type)"undefined"!=typeof o.source.name?"flickr"==o.source.name?(r.asset.media="//flickr.com/photos/"+o.meta.pathalias+"/"+o.meta.id+"/",r.asset.credit="<a href='"+r.asset.media+"'>"+o.attribution.name+"</a>",r.asset.credit+=" on <a href='"+o.source.href+"'>"+o.source.name+"</a>"):"instagram"==o.source.name?(r.asset.media=o.permalink,r.asset.credit="<a href='"+o.permalink+"'>"+o.attribution.name+"</a>",r.asset.credit+=" on <a href='"+o.source.href+"'>"+o.source.name+"</a>"):(r.asset.credit="<a href='"+o.permalink+"'>"+o.attribution.name+"</a>","undefined"!=typeof o.source.href&&(r.asset.credit+=" on <a href='"+o.source.href+"'>"+o.source.name+"</a>"),r.asset.media=o.data.image.src):(r.asset.credit="<a href='"+o.permalink+"'>"+o.attribution.name+"</a>",r.asset.media=o.data.image.src),r.slug=o.attribution.name,"undefined"!=typeof o.data.image.caption&&"undefined"!=o.data.image.caption&&(r.asset.caption=o.data.image.caption,r.slug=o.data.image.caption);else if("quote"==o.type)o.permalink.match("twitter")?(r.asset.media=o.permalink,r.slug=VMM.Util.untagify(o.data.quote.text)):o.permalink.match("storify")&&(l=!0,r.asset.media="<blockquote>"+o.data.quote.text.replace(/<\s*\/?\s*b\s*.*?>/g,"")+"</blockquote>");else if("link"==o.type)r.headline=o.data.link.title,r.text=o.data.link.description,r.asset.media="undefined"!=o.data.link.thumbnail&&""!=o.data.link.thumbnail?o.data.link.thumbnail:o.permalink,r.asset.caption="<a href='"+o.permalink+"' target='_blank'>"+o.data.link.title+"</a>",r.slug=o.data.link.title;else if("text"==o.type){if(o.permalink.match("storify")){l=!0;{e.content.author.username}"undefined"!=typeof o.attribution.name&&(i=o.attribution.name,n=o.attribution.username+"&nbsp;");var d="<div class='storify'>";d+="<blockquote><p>"+o.data.text.replace(/<\s*\/?\s*b\s*.*?>/g,"")+"</p></blockquote>",d+="<div class='vcard author'><a class='screen-name url' href='"+o.attribution.href+"' target='_blank'>",d+="<span class='avatar'><img src='"+o.attribution.thumbnail+"' style='max-width: 32px; max-height: 32px;'></span>",d+="<span class='fn'>"+i+"</span>",d+="<span class='nickname'>"+n+"<span class='thumbnail-inline'></span></span>",d+="</a></div></div>",r.text=d,s+1>=e.content.elements.length?r.startDate=e.content.elements[s-1].posted_at:"text"==e.content.elements[s+1].type&&e.content.elements[s+1].permalink.match("storify")?s+2>=e.content.elements.length?r.startDate=e.content.elements[s-1].posted_at:"text"==e.content.elements[s+2].type&&e.content.elements[s+2].permalink.match("storify")?s+3>=e.content.elements.length?r.startDate=e.content.elements[s-1].posted_at:"text"==e.content.elements[s+3].type&&e.content.elements[s+3].permalink.match("storify")?r.startDate=e.content.elements[s-1].posted_at:(trace("LEVEL 3"),r.startDate=e.content.elements[s+3].posted_at):(trace("LEVEL 2"),r.startDate=e.content.elements[s+2].posted_at):(trace("LEVEL 1"),r.startDate=e.content.elements[s+1].posted_at),r.endDate=r.startDate}}else"video"==o.type?(r.headline=o.data.video.title,r.asset.caption=o.data.video.description,r.asset.caption=o.source.username,r.asset.media=o.data.video.src):(trace("NO MATCH "),trace(o));l&&(r.slug=VMM.Util.untagify(o.data.text)),t.timeline.date.push(r)}VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,t)}},tweets:{type:"twitter",buildData:function(e){VMM.bindEvent(global,VMM.Timeline.DataObj.model.tweets.onTwitterDataReady,"TWEETSLOADED"),VMM.ExternalAPI.twitter.getTweets(e.timeline.tweets)},getData:function(e){VMM.bindEvent(global,VMM.Timeline.DataObj.model.tweets.onTwitterDataReady,"TWEETSLOADED"),VMM.ExternalAPI.twitter.getTweetSearch(e)},onTwitterDataReady:function(e,t){for(var a=VMM.Timeline.DataObj.data_template_obj,i=0;i<t.tweetdata.length;i++){var n={type:"tweets",startDate:"",headline:"",text:"",asset:{media:"",credit:"",caption:""},tags:"Optional"};n.startDate=t.tweetdata[i].raw.created_at,n.headline=type.of(t.tweetdata[i].raw.from_user_name)?t.tweetdata[i].raw.from_user_name+" (<a href='https://twitter.com/"+t.tweetdata[i].raw.from_user+"'>@"+t.tweetdata[i].raw.from_user+"</a>)":t.tweetdata[i].raw.user.name+" (<a href='https://twitter.com/"+t.tweetdata[i].raw.user.screen_name+"'>@"+t.tweetdata[i].raw.user.screen_name+"</a>)",n.asset.media=t.tweetdata[i].content,a.timeline.date.push(n)}VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,a)}}},data_template_obj:{timeline:{headline:"",description:"",asset:{media:"",credit:"",caption:""},date:[],era:[]}},date_obj:{startDate:"2012,2,2,11,30",headline:"",text:"",asset:{media:"http://youtu.be/vjVfu8-Wp6s",credit:"",caption:""},tags:"Optional"}});