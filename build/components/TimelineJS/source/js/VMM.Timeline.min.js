"undefined"!=typeof VMM&&"undefined"==typeof VMM.Timeline&&(VMM.Timeline=function(e,t,i){function a(e){"object"==typeof embed_config&&(timeline_config=embed_config),"object"==typeof timeline_config?(trace("HAS TIMELINE CONFIG"),B=VMM.Util.mergeConfig(B,timeline_config)):"object"==typeof e&&(B=VMM.Util.mergeConfig(B,e)),("mobile"==VMM.Browser.device||"tablet"==VMM.Browser.device)&&(B.touch=!0),B.nav.width=B.width,B.nav.height=200,B.feature.width=B.width,B.feature.height=B.height-B.nav.height,B.nav.zoom.adjust=parseInt(B.start_zoom_adjust,10),VMM.Timeline.Config=B,VMM.master_config.Timeline=VMM.Timeline.Config,this.events=B.events,""!=B.gmap_key&&(B.api_keys.google=B.gmap_key),trace("VERSION "+B.version),S=B.version}function n(){E=VMM.getElement(C),VMM.Lib.addClass(E,"vco-timeline"),VMM.Lib.addClass(E,"vco-storyjs"),D=VMM.appendAndGetElement(E,"<div>","vco-container vco-main"),I=VMM.appendAndGetElement(D,"<div>","vco-feature"),T=VMM.appendAndGetElement(I,"<div>","vco-slider"),A=VMM.appendAndGetElement(D,"<div>","vco-navigation"),L=VMM.appendAndGetElement(E,"<div>","vco-feedback",""),"undefined"!=typeof B.language.right_to_left&&VMM.Lib.addClass(E,"vco-right-to-left"),k=new VMM.Slider(T,B),x=new VMM.Timeline.TimeNav(A),z?VMM.Lib.width(E,B.width):B.width=VMM.Lib.width(E),G?VMM.Lib.height(E,B.height):B.height=VMM.Lib.height(E),B.touch?VMM.Lib.addClass(E,"vco-touch"):VMM.Lib.addClass(E,"vco-notouch")}function r(e,t){trace("onDataReady"),N=t.timeline,"array"!=type.of(N.era)&&(N.era=[]),y()}function s(){_()}function d(){b(),k.setSize(B.feature.width,B.feature.height),x.setSize(B.width,B.height),p()&&m()}function o(){B.loaded.slider=!0,l()}function l(){B.loaded.percentloaded=B.loaded.percentloaded+25,B.loaded.slider&&B.loaded.timenav&&V()}function M(){B.loaded.timenav=!0,l()}function u(){O=!0,B.current_slide=k.getCurrentNumber(),c(B.current_slide),x.setMarker(B.current_slide,B.ease,B.duration)}function g(){O=!0,B.current_slide=x.getCurrentNumber(),c(B.current_slide),k.setSlide(B.current_slide)}function h(e){e<=j.length-1&&e>=0&&(B.current_slide=e,k.setSlide(B.current_slide),x.setMarker(B.current_slide,B.ease,B.duration))}function c(e){B.hash_bookmark&&(window.location.hash="#"+e.toString())}function m(){var e="",t=f(window.orientation);"mobile"==VMM.Browser.device?e="portrait"==t?"width=device-width; initial-scale=0.5, maximum-scale=0.5":"landscape"==t?"width=device-width; initial-scale=0.5, maximum-scale=0.5":"width=device-width, initial-scale=1, maximum-scale=1.0":"tablet"==VMM.Browser.device,document.getElementById("viewport")}function f(e){var t="";return t=0==e||180==e?"portrait":90==e||-90==e?"landscape":"normal"}function p(){var e=f(window.orientation);return e==B.orientation?!1:(B.orientation=e,!0)}function v(e,t,i){trace("showMessege "+t),i?VMM.attachElement(L,t):VMM.attachElement(L,VMM.MediaElement.loadingmessage(t))}function V(){VMM.Lib.animate(L,B.duration,4*B.ease,{opacity:0},w)}function w(){VMM.Lib.detach(L)}function _(){parseInt(B.start_at_slide)>0&&0==B.current_slide&&(B.current_slide=parseInt(B.start_at_slide)),B.start_at_end&&0==B.current_slide&&(B.current_slide=j.length-1),H?(H=!0,VMM.fireEvent(global,B.events.messege,"Internet Explorer "+VMM.Browser.version+" is not supported by TimelineJS. Please update your browser to version 8 or higher. If you are using a recent version of Internet Explorer you may need to disable compatibility mode in your browser.")):(w(),d(),VMM.bindEvent(T,o,"LOADED"),VMM.bindEvent(A,M,"LOADED"),VMM.bindEvent(T,u,"UPDATE"),VMM.bindEvent(A,g,"UPDATE"),k.init(j),x.init(j,N.era),VMM.bindEvent(global,d,B.events.resize))}function b(){trace("UPDATE SIZE"),B.width=VMM.Lib.width(E),B.height=VMM.Lib.height(E),B.nav.width=B.width,B.feature.width=B.width,B.feature.height=B.height-B.nav.height-3,"mobile"==VMM.Browser.device,B.width<641?VMM.Lib.addClass(E,"vco-skinny"):VMM.Lib.removeClass(E,"vco-skinny")}function y(){j=[],VMM.fireEvent(global,B.events.messege,"Building Dates"),b();for(var e=0;e<N.date.length;e++)if(null!=N.date[e].startDate&&""!=N.date[e].startDate){var t={},i=VMM.Date.parse(N.date[e].startDate,!0);t.startdate=i.date,t.precisiondate=i.precision,isNaN(t.startdate)||(t.enddate=null!=N.date[e].endDate&&""!=N.date[e].endDate?VMM.Date.parse(N.date[e].endDate):t.startdate,t.needs_slug=!1,""==N.date[e].headline&&null!=N.date[e].slug&&""!=N.date[e].slug&&(t.needs_slug=!0),t.title=N.date[e].headline,t.headline=N.date[e].headline,t.type=N.date[e].type,t.date=VMM.Date.prettyDate(t.startdate,!1,t.precisiondate),t.asset=N.date[e].asset,t.fulldate=t.startdate.getTime(),t.text=N.date[e].text,t.content="",t.tag=N.date[e].tag,t.slug=N.date[e].slug,t.uniqueid=VMM.Util.unique_ID(7),t.classname=N.date[e].classname,j.push(t))}if("storify"!=N.type&&j.sort(function(e,t){return e.fulldate-t.fulldate}),null!=N.headline&&""!=N.headline&&null!=N.text&&""!=N.text){var a,i,n,t={};"undefined"!=typeof N.startDate?(i=VMM.Date.parse(N.startDate,!0),a=i.date):a=!1,trace("HAS STARTPAGE"),trace(a),a&&a<j[0].startdate?t.startdate=new Date(a):(n=j[0].startdate,t.startdate=new Date(j[0].startdate),0===n.getMonth()&&1==n.getDate()&&0===n.getHours()&&0===n.getMinutes()?t.startdate.setFullYear(n.getFullYear()-1):n.getDate()<=1&&0===n.getHours()&&0===n.getMinutes()?t.startdate.setMonth(n.getMonth()-1):0===n.getHours()&&0===n.getMinutes()?t.startdate.setDate(n.getDate()-1):0===n.getMinutes()?t.startdate.setHours(n.getHours()-1):t.startdate.setMinutes(n.getMinutes()-1)),t.uniqueid=VMM.Util.unique_ID(7),t.enddate=t.startdate,t.precisiondate=i.precision,t.title=N.headline,t.headline=N.headline,t.text=N.text,t.type="start",t.date=VMM.Date.prettyDate(N.startDate,!1,t.precisiondate),t.asset=N.asset,t.slug=!1,t.needs_slug=!1,t.fulldate=t.startdate.getTime(),B.embed&&VMM.fireEvent(global,B.events.headline,t.headline),j.unshift(t)}"storify"!=N.type&&j.sort(function(e,t){return e.fulldate-t.fulldate}),s()}var E,D,I,L,T,A,k,x,S="2.x",C="#timelinejs",N={},j=[],B={},z=!1,G=!1,H=!1,O=!1;if(C="string"==type.of(e)?e.match("#")?e:"#"+e:"#timelinejs",B={embed:!1,events:{data_ready:"DATAREADY",messege:"MESSEGE",headline:"HEADLINE",slide_change:"SLIDE_CHANGE",resize:"resize"},id:C,source:"nothing",type:"timeline",touch:!1,orientation:"normal",maptype:"",version:"2.x",preload:4,current_slide:0,hash_bookmark:!1,start_at_end:!1,start_at_slide:0,start_zoom_adjust:0,start_page:!1,api_keys:{google:"",flickr:"",twitter:""},interval:10,something:0,width:960,height:540,spacing:15,loaded:{slider:!1,timenav:!1,percentloaded:0},nav:{start_page:!1,interval_width:200,density:4,minor_width:0,minor_left:0,constraint:{left:0,right:0,right_min:0,right_max:0},zoom:{adjust:0},multiplier:{current:6,min:.1,max:50},rows:[1,1,1],width:960,height:200,marker:{width:150,height:50}},feature:{width:960,height:540},slider:{width:720,height:400,content:{width:720,height:400,padding:130,padding_default:130},nav:{width:100,height:200}},ease:"easeInOutExpo",duration:1e3,gmap_key:"",language:VMM.Language},null!=t&&""!=t&&(B.width=t,z=!0),null!=i&&""!=i&&(B.height=i,G=!0),window.location.hash){var P=window.location.hash.substring(1);isNaN(P)||(B.current_slide=parseInt(P))}window.onhashchange=function(){var e=window.location.hash.substring(1);B.hash_bookmark?O?h(parseInt(e)):O=!1:h(parseInt(e))},this.init=function(e,t){trace("INIT"),m(),a(e),n(),"string"==type.of(t)&&(B.source=t),VMM.Date.setLanguage(B.language),VMM.master_config.language=B.language,VMM.ExternalAPI.setKeys(B.api_keys),VMM.ExternalAPI.googlemaps.setMapType(B.maptype),VMM.bindEvent(global,r,B.events.data_ready),VMM.bindEvent(global,v,B.events.messege),VMM.fireEvent(global,B.events.messege,B.language.messages.loading_timeline),("Explorer"==VMM.Browser.browser||"MSIE"==VMM.Browser.browser)&&parseInt(VMM.Browser.version,10)<=7&&(null==VMM.Browser.tridentVersion||VMM.Browser.tridentVersion<4)&&(H=!0),"string"==type.of(B.source)||"object"==type.of(B.source)?VMM.Timeline.DataObj.getData(B.source):VMM.fireEvent(global,B.events.messege,"No data source provided")},this.iframeLoaded=function(){trace("iframeLoaded")},this.reload=function(e){trace("Load new timeline data"+e),VMM.fireEvent(global,B.events.messege,B.language.messages.loading_timeline),N={},VMM.Timeline.DataObj.getData(e),B.current_slide=0,k.setSlide(0),x.setMarker(0,B.ease,B.duration)}},VMM.Timeline.Config={});